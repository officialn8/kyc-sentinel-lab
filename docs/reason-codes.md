# Reason Code Taxonomy

This document describes all reason codes generated by the KYC Sentinel detection engine.

## Overview

Reason codes provide explainable, auditable justifications for detection decisions. Each code includes:

- **Code**: Machine-readable identifier
- **Severity**: `info` | `warn` | `high`
- **Message**: Human-readable explanation
- **Evidence**: Supporting data (JSON)

## Face Matching

| Code | Severity | Description |
|------|----------|-------------|
| `FACE_MISMATCH` | high | Selfie face does not match ID photo |
| `FACE_NOT_DETECTED_SELFIE` | high | No face detected in selfie image |
| `FACE_NOT_DETECTED_ID` | high | No face detected in ID document |
| `MULTIPLE_FACES_SELFIE` | warn | Multiple faces detected in selfie |

### Evidence Fields

```json
{
  "similarity": 0.45,
  "threshold": 0.75,
  "selfie_bbox": [100, 100, 300, 300],
  "id_bbox": [50, 50, 200, 250]
}
```

## Presentation Attack Detection (PAD)

| Code | Severity | Description |
|------|----------|-------------|
| `PAD_SUSPECT_REPLAY` | high | Screen capture artifacts suggesting replay |
| `PAD_SCREEN_ARTIFACTS` | warn | Moiré patterns or screen glare detected |
| `PAD_LOW_MOTION_ENTROPY` | warn | Insufficient natural movement in video |
| `PAD_FRAME_STUTTER` | warn | Inconsistent frame timing (video replay) |
| `PAD_INJECTION_ARTIFACTS` | high | Virtual camera injection artifacts |
| `PAD_FACE_BOUNDARY_MISMATCH` | high | Face boundary inconsistent (face swap) |

### Evidence Fields

```json
{
  "pad_score": 0.82,
  "frame_indices": [12, 13, 14, 15],
  "artifacts": ["moire_pattern", "screen_glare"],
  "motion_entropy": 0.15,
  "suspicious_frames": 4
}
```

## Document Analysis

| Code | Severity | Description |
|------|----------|-------------|
| `DOC_TEMPLATE_MISMATCH` | warn | Layout doesn't match expected template |
| `DOC_OCR_LOW_CONFIDENCE` | warn | Low confidence in text extraction |
| `DOC_FONT_INCONSISTENT` | warn | Inconsistent fonts in document text |
| `DOC_TEXT_MISALIGNED` | warn | Text alignment issues |
| `DOC_EDGE_ARTIFACTS` | warn | Editing artifacts around edges |
| `DOC_METADATA_SUSPICIOUS` | info | Suspicious image metadata |

### Evidence Fields

```json
{
  "ocr_confidence": 0.65,
  "template_match": 0.72,
  "font_variations": 3,
  "affected_regions": ["name_field", "date_field"],
  "edge_score": 0.45
}
```

## Metadata / Device

| Code | Severity | Description |
|------|----------|-------------|
| `META_HIGH_RISK_DEVICE` | warn | Session from high-risk device profile |
| `META_SUSPICIOUS_TIMING` | info | Timing patterns suggest automation |
| `META_MULTIPLE_RETRIES` | info | Multiple retry attempts detected |

### Evidence Fields

```json
{
  "device_os": "Android 8.0",
  "device_model": "Generic VM",
  "ip_country": "XX",
  "session_duration_ms": 1200,
  "retry_count": 5
}
```

## Severity Guidelines

### High
- Strong indicator of fraud
- Automatic fail decision
- Requires investigation

### Warn
- Suspicious pattern detected
- May trigger review decision
- Should be examined by analyst

### Info
- Informational only
- Does not affect scoring
- Useful for investigation

## Combining Reason Codes

Multiple reason codes combine to determine the final decision:

1. Any `high` severity → automatic fail
2. Multiple `warn` codes → likely review
3. Only `info` codes → no impact

## Adding New Reason Codes

1. Add enum value to `ReasonCode` in `backend/app/services/reason_codes.py`
2. Add message template to `REASON_MESSAGES`
3. Update default severity in `get_reason_severity()`
4. Document evidence fields in this file



